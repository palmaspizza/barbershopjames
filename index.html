<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservas Barber√≠a</title>


  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  
  <div class="container">
    <center><img id="logo" src="https://i.ibb.co/JFrnTqWc/c4497cf0-2f10-43bf-b5ac-6c232c4d0e18.jpg" style="width: 50%; border-radius: 50%;" alt=""></center>
    <h1>Reservar Hora</h1>
    <div style="margin-bottom: 10px;">

</div>

<!-- Modal de Acceso -->
<div id="modal-acceso"  class="ventana-secreta fantasma">
  <div class="caja-misteriosa">
    <h3>ACCESO</h3>
    <input type="password" id="clave-input" maxlength="4" placeholder="Clave de 4 d√≠gitos">
    <br><br>
    <button onclick="validarClave()">Ingresar</button>
    <br><br>
    <button onclick="cerrarModal('modal-acceso')">Cerrar</button>
  </div>
</div>


<!-- Modal de Control -->
<div id="modal-control" class="ventana-secreta fantasma">
  <div class="caja-misteriosa">
    <h3>Control Barber√≠a</h3>
    <button onclick="abrirBarberia()">Abrir Barber√≠a</button>
    <br><br>
    <button onclick="mostrarModalMensaje()">Cerrar Barber√≠a</button>
    <br><br>
    <button onclick="cerrarModal('modal-control');borrarTodasLasHorasEnPantalla()">üßπ borrar TODAS las reservas</button>

     <br><br>
    <button onclick="borrarHorasMesHastaHoy()">Borrar horas antiguas del MES</button>
    <br><br>
      <button style="background: #00cc66; color: black;" onclick="mostrarBotonesX();cerrarModal('modal-control');">ELIMINAR 1 RESERVA‚ùå</button>
    <br><br>
    <button onclick="cerrarModal('modal-control')">Cerrar</button>
  </div>
</div>

<!-- Modal para dejar mensaje -->
<div id="modal-mensaje" class="ventana-secreta fantasma">
  <div class="caja-misteriosa">
    <h3>Deja un mensaje mientras tu local est√° cerrado</h3>
    <input type="text" id="mensaje-cierre" placeholder="Escribe tu mensaje aqu√≠">
    <br><br>
    <button onclick="guardarMensajeCierre()">Aceptar</button>
  </div>
</div>





<!-- Modal CERRADO -->
<div id="modal-cerrado" class="pantalla-negra fantasma">
  <h1>CERRADO</h1>
   <p id="mensaje-cerrado" style="margin-top: 20px; font-size: 24px;"></p>
  <img style="border-radius: 50%; width: 50%;" id="logo-cerrado" src="https://i.ibb.co/JFrnTqWc/c4497cf0-2f10-43bf-b5ac-6c232c4d0e18.jpg" style="width: 50%;">

</div>
<label for="nombre">Nombre:</label>
<input type="text" type="name" id="nombre" oninput="miFuncion();">
    <button style="color: #000;" onclick="abrirCalendario()">üìÖ Elegir/Cambiar: D√≠a</button>
    <input type="date" id="fecha" class="oculto" required>

    <label for="hora">Seleccionar hora:</label>
    <select id="hora" required>
      <option value="">-- Selecciona una hora --</option>
      <option value="09:00">09:00</option>
      <option value="10:00">10:00</option>
      <option value="11:00">11:00</option>
      <option value="12:00">12:00</option>
      <option value="13:00">13:00</option>
      <option value="14:00">14:00</option>
      <option value="15:00">15:00</option>
      <option value="16:00">16:00</option>
      <option value="17:00">17:00</option>
      <option value="18:00">18:00</option>
      <option value="19:00">19:00</option>
      <option value="20:00">20:00</option>
    </select>

    <button hidden id="reservar-button" onclick="reservarHora()">Reservar</button>

    <h2>Horas Reservadas</h2>
    <div id="reservas-lista"></div>
  </div>

  <!-- Modal Ocupado -->
  <div id="modal-ocupado" class="modal hidden">
    <div class="modal-content ocupado">
      <h3>HORA OCUPADA</h3>
      <p>slecciona otra</p>
      <button onclick="cerrarModal('modal-ocupado')">Aceptar</button>
    </div>
  </div>

  <!-- Modal Reservada -->
  <div id="modal-reservada" class="modal hidden">
    <div class="modal-content reservada">
      <h3>HORA DISPONIBLE</h3>
      <button onclick="enviarMensajeWhatsApp();cerrarModal('modal-reservada');location.reload();">RESERVAR</button>
    </div>
  </div>
<script>
  function reservarHora() {
  const fecha = fechaInput.value;
  const hora = horaInput.value;
  const nombre = document.getElementById("nombre").value.trim();

  if (!fecha || !hora || !nombre) {
    alert("Completa todos los campos: nombre, fecha y hora");
    return;
  }

  const idBloque = `${fecha}-${hora}`;

  reservasRef.once("value", snapshot => {
    let ocupada = false;
    snapshot.forEach(child => {
      const r = child.val();
      if (`${r.fecha}-${r.hora}` === idBloque) {
        ocupada = true;
      }
    });

    if (ocupada) {
      document.getElementById("modal-ocupado").classList.remove("hidden");
    } else {
      reservasRef.push({ fecha, hora, nombre });
      document.getElementById("modal-reservada").classList.remove("hidden");

      // ‚úÖ Enviar mensaje por WhatsApp
      enviarMensajeWhatsApp(nombre, fecha, hora);
    }
  });
}



function enviarMensajeWhatsApp() {
  const nombre = document.getElementById("nombre")?.value.trim();
  const fecha = document.getElementById("fecha")?.value;
  const hora = document.getElementById("hora")?.value;

  if (!nombre || !fecha || !hora) {
    alert("Faltan datos: aseg√∫rate de ingresar nombre, fecha y hora");
    return;
  }

  const numeroDestino = "56912345678"; // ‚Üê Cambia esto por el n√∫mero real
  const mensaje = `Hola, soy ${nombre}. Quiero reservar para el d√≠a ${fecha} a las ${hora}.`;
  const url = `https://wa.me/${numeroDestino}?text=${encodeURIComponent(mensaje)}`;

  window.open(url, "_blank");
}
function borrarTodasLasHorasEnPantalla() {
  // Elimina TODAS las reservas de Firebase
  reservasRef.remove()
    .then(() => {
      console.log("Todas las reservas han sido eliminadas de Firebase");

      // Limpia la pantalla local
      const lista = document.getElementById("reservas-lista");
      if (!lista) {
        console.warn("No se encontr√≥ el contenedor de reservas");
        return;
      }

      while (lista.firstChild) {
        lista.removeChild(lista.firstChild);
      }

      console.log("Todas las horas en pantalla han sido eliminadas");
    })
    .catch(error => {
      console.error("Error al borrar las reservas:", error);
    });
}




</script>
  <script src="script.js"></script>
</body>
</html>
