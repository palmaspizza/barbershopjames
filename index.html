<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservas Barber√≠a</title>


  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  
  <div class="container">
   <div id="logo" style="
  width: 300px;
  height: 300px;
  background-image: url('https://i.ibb.co/JFrnTqWc/c4497cf0-2f10-43bf-b5ac-6c232c4d0e18.jpg');
  background-size: cover;
  background-position: center;
  border-radius: 50%;
  margin: auto;
"></div><br>
<div id="barraMes" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
<div id="barraMes" style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 10px;">
  <button id="mesAnterior" class="botonMes">‚Üê</button>
  <h2 id="tituloMes" style="margin: 0;">Septiembre 2025</h2>
  <button id="mesSiguiente" class="botonMes">‚Üí</button>
</div>


</div>
<div id="cuadroCalendario"></div>

<input type="month" hidden id="selectorMes"/>


<button onclick="desactiwar();" hidden id="desactivarBloqueoDias">‚úÖ Desactivar bloqueo</button>
    <h1 style="text-shadow: #000 3px 3px 5px;">Hora</h1>
    <div style="margin-bottom: 10px;">

</div>

<!-- Modal de Acceso -->
<div id="modal-acceso"  class="ventana-secreta fantasma">
  <div class="caja-misteriosa">
    <h3>ACCESO</h3>
    <input type="password" id="clave-input" maxlength="4" placeholder="Clave de 4 d√≠gitos">
    <br><br>
    <button onclick="validarClave()">Ingresar</button>
    <br><br>
    <button onclick="cerrarModal('modal-acceso')">Cerrar</button>
  </div>
</div>


<!-- Modal de Control -->
<div id="modal-control" class="ventana-secreta fantasma">
  <div class="caja-misteriosa">
    <h3>Control Barber√≠a</h3>
    <button onclick="abrirBarberia()">Abrir Barber√≠a</button>
    <br><br>
    <button onclick="mostrarModalMensaje()">Cerrar Barber√≠a</button>
    <br><br>
    <button onclick="cerrarModal('modal-control');borrarTodasLasHorasEnPantalla()">üßπ borrar TODAS las reservas</button>
<br><br><button onclick="actiwar()" style="border: 2px solid white;" id="activarBloqueoDias">üîí Activar bloqueo de d√≠as</button>
     <br><br>
    <button onclick="borrarHorasMesHastaHoy()">Borrar horas antiguas del MES</button>
    <br><br>
      <button style="background: #00cc66; color: black;" onclick="mostrarBotonesX();cerrarModal('modal-control');">ELIMINAR 1 RESERVA‚ùå</button>
    <br><br>
    <button onclick="cerrarModal('modal-control')">Cerrar</button>
  </div>
</div>

<!-- Modal para dejar mensaje -->
<div id="modal-mensaje" class="ventana-secreta fantasma">
  <div class="caja-misteriosa">
    <h3>Deja un mensaje mientras tu local est√° cerrado</h3>
    <input type="text" id="mensaje-cierre" placeholder="Escribe tu mensaje aqu√≠">
    <br><br>
    <button onclick="guardarMensajeCierre()">Aceptar</button>
  </div>
</div>





<!-- Modal CERRADO -->
<div id="modal-cerrado" class="pantalla-negra fantasma">
  <h1>CERRADO</h1>
   <p id="mensaje-cerrado" style="margin-top: 20px; font-size: 24px;"></p>
  
   <div id="logo-cerrado" style="
  width: 200px;
  height: 200px;
  background-image: url('https://i.ibb.co/JFrnTqWc/c4497cf0-2f10-43bf-b5ac-6c232c4d0e18.jpg');
  background-size: cover;
  background-position: center;
  border-radius: 50%;
  margin: auto;
"></div>
</div>


    <input type="date" id="fecha" hidden class="" required>

    
<center>
  <input type="time"  id="hora">
<div style="margin-bottom: 10px;">


</div>

<script>
  
function actiwar(){
  document.getElementById("desactivarBloqueoDias").hidden = false;
}

function desactiwar(){
  document.getElementById("desactivarBloqueoDias").hidden = true;
}
</script>
</center>
<!-- Modal de horarios -->
<div id="ventanaHorarios" class="modalBarberia">
  <div class="contenidoModal">
    <span id="cerrarVentana" class="cerrarModal">&times;</span>
    <h3 id="tituloVentana"></h3>
    <div id="horariosDisponibles"></div>
  </div>
</div>


  <h2 style="color: red !important; text-shadow: #000 1px 1px 2px;">Horas Reservadas</h2>
    <input style="border: 1px solid red;" type="text" id="buscadorGlobal" placeholder="Buscar d√≠a..." />
    <div id="reservas-lista"></div>
  </div>

<div id="modal-hora-personalizada" class="modal hidden">
  <div class="modal-content">
    <h3>Nombre</h3>
   <input type="text" type="name" placeholder="Escribe tu nombre" id="nombre" oninput="miFuncion();">
  
    <br><br>
 <button id="reservar-button" onclick="reservarHora()">Reservar</button>  </div>
</div>


  <!-- Modal Reservada -->
  <div id="modal-reservada" class="modal hidden">
    <div class="modal-content reservada">
      <h3>HORA DISPONIBLE</h3>
    </div>
  </div>
<script>
  function reservarHora() {
  const fecha = fechaInput.value;
  const hora = horaInput.value;
  const nombre = document.getElementById("nombre").value.trim();

  if (!fecha || !hora || !nombre) {
    alert("Completa todos los campos: nombre, fecha y hora");
    return;
  }

  const idBloque = `${fecha}-${hora}`;

  reservasRef.once("value", snapshot => {
    let ocupada = false;
    snapshot.forEach(child => {
      const r = child.val();
      if (`${r.fecha}-${r.hora}` === idBloque) {
        ocupada = true;
      }
    });

    if (ocupada) {
      document.getElementById("modal-ocupado").classList.remove("hidden");
    } else {
      reservasRef.push({ fecha, hora, nombre });
      document.getElementById("modal-reservada").classList.remove("hidden");

      // ‚úÖ Enviar mensaje por WhatsApp
      enviarMensajeWhatsApp(nombre, fecha, hora);
    }
  });
}



function enviarMensajeWhatsApp() {
  const nombre = document.getElementById("nombre")?.value.trim();
  const fecha = document.getElementById("fecha")?.value;
  const hora = document.getElementById("hora")?.value;

  if (!nombre || !fecha || !hora) {
    alert("Faltan datos: aseg√∫rate de ingresar nombre, fecha y hora");
    return;
  }

  const numeroDestino = "56954527837"; // ‚Üê Cambia esto por el n√∫mero real
  const mensaje = `Hola, soy ${nombre}. Quiero reservar para el d√≠a ${fecha} a las ${hora}.`;
  const url = `https://wa.me/${numeroDestino}?text=${encodeURIComponent(mensaje)}`;

  window.open(url, "_blank");
}
function borrarTodasLasHorasEnPantalla() {
  // Elimina TODAS las reservas de Firebase
  reservasRef.remove()
    .then(() => {
      console.log("Todas las reservas han sido eliminadas de Firebase");

      // Limpia la pantalla local
      const lista = document.getElementById("reservas-lista");
      if (!lista) {
        console.warn("No se encontr√≥ el contenedor de reservas");
        return;
      }

      while (lista.firstChild) {
        lista.removeChild(lista.firstChild);
      }

      console.log("Todas las horas en pantalla han sido eliminadas");
    })
    .catch(error => {
      console.error("Error al borrar las reservas:", error);
    });
}




</script>
  <script src="script.js"></script>
</body>
</html>
